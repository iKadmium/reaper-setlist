import{g as K,n as T,r as D,B as ne,e as ie}from"../chunks/BaaqWfM4.js";import{f as y,a as v,s as G,t as le}from"../chunks/Cyv9BU93.js";import{p as ce,k as C,q as m,v as ue,s as k,f as H,a as de,l as t,o as u,c as _,r as b,t as F,n as M}from"../chunks/CXoDX78y.js";import{i as O}from"../chunks/CshSjHoe.js";import{b as J}from"../chunks/DK1uu51e.js";import{S as fe}from"../chunks/BACbJRNS.js";const pe=async({fetch:$,params:d})=>{try{const s=d.id,i=K($),[l,f]=await Promise.all([i.sets.get(s),i.songs.list()]);return{set:l,songs:f}}catch(s){return{set:void 0,songs:{},error:s instanceof Error?s.message:"An unknown error occurred."}}},ke=Object.freeze(Object.defineProperty({__proto__:null,load:pe},Symbol.toStringTag,{value:"Module"}));var ge=y('<p style="color: red;"> </p>'),ve=y('<div class="steps-container svelte-3gqsnu"></div>'),be=y('<div class="options-container svelte-3gqsnu"><label class="checkbox-label svelte-3gqsnu"><input type="checkbox" class="svelte-3gqsnu"/> Replace existing tabs (close all tabs before loading)</label> <label class="checkbox-label svelte-3gqsnu"><input type="checkbox" class="svelte-3gqsnu"/> Move playhead to start for each song</label></div> <div class="load-button-container svelte-3gqsnu"><!></div> <!>',1),he=y("<p>Set not found.</p>"),me=y("<meta:head><title>Load Set - Reaper Setlist</title></meta:head> <h1>Load Set</h1> <!>",1);function $e($,d){ce(d,!0);let s=m(!1),i=m(!1),l=m(!0),f=m(!0),h=C(d.data.set),Q=C(d.data.songs);const B=d.data.error,w=K();let c=m(C([]));ue(()=>{h&&!t(s)&&!t(i)&&z(),t(l),t(f)});function z(){if(!h)return;const e=[];t(l)&&e.push({id:"close-all-tabs",title:"Close All Tabs",description:"Close all existing tabs in Reaper before loading the setlist",status:"pending",action:()=>W()}),h.songs.forEach((a,r)=>{const o=Q[a];(r>0||!t(l))&&e.push({id:r===0?"open-new-tab-initial":`new-tab-${r}`,title:"Open New Tab",description:r===0?"Create a new tab in Reaper for the setlist":`Create a new tab in Reaper for ${o.name}`,status:"pending",action:()=>V()}),e.push({id:`load-song-${a}`,title:`Load ${o.name}`,description:`Load the project file for ${o.name}`,status:"pending",action:()=>U(o)}),t(f)&&e.push({id:`go-to-start-${r}`,title:"Move Playhead to Start",description:`Position the playhead at the beginning of ${o.name}`,status:"pending",action:()=>X()})}),u(c,e,!0)}async function U(e){try{return await w.script.openProject(e.path),!0}catch(a){return T.error(`Failed to load song "${e.name}": ${a.message}`),!1}}async function V(){try{return await w.reaper.newTab(),!0}catch(e){return T.error(`Failed to open new tab: ${e.message}`),!1}}async function W(){try{return await w.reaper.closeAllTabs(),!0}catch(e){return T.error(`Failed to close all tabs: ${e.message}`),!1}}async function X(){try{return await w.reaper.goToStart(),!0}catch(e){return T.error(`Failed to move playhead to start: ${e.message}`),!1}}function q(e,a){const r=t(c).findIndex(o=>o.id===e);r!==-1&&(t(c)[r].status=a)}async function Y(e){q(e.id,"running");try{let a=!1;return a=await e.action(),q(e.id,a?"completed":"error"),a}catch(a){return console.error(`Error executing step ${e.id}:`,a),q(e.id,"error"),!1}}async function Z(){if(!(!h||t(s))&&(t(i)&&(u(i,!1),z()),t(c).length!==0)){u(s,!0),u(i,!0);try{for(const e of t(c))await Y(e)||console.warn(`Step ${e.id} failed, but continuing...`),await new Promise(r=>setTimeout(r,200))}catch(e){console.error("Error during setlist loading:",e)}finally{u(s,!1)}}}var I=me(),ee=k(H(I),4);{var te=e=>{var a=ge(),r=_(a,!0);b(a),F(()=>G(r,B)),v(e,a)},ae=(e,a)=>{{var r=p=>{var S=be(),P=H(S),L=_(P),A=_(L);D(A),M(),b(L);var N=k(L,2),E=_(N);D(E),M(),b(N),b(P);var R=k(P,2),re=_(R);ne(re,{onclick:Z,get disabled(){return t(s)},children:(n,x)=>{M();var g=le();F(()=>G(g,t(s)?"Loading...":t(i)?"Load Again":"Load Set")),v(n,g)},$$slots:{default:!0}}),b(R);var se=k(R,2);{var oe=n=>{var x=ve();ie(x,21,()=>t(c),g=>g.id,(g,j)=>{fe(g,{get title(){return t(j).title},get description(){return t(j).description},get status(){return t(j).status}})}),b(x),v(n,x)};O(se,n=>{t(c).length>0&&n(oe)})}F(()=>{A.disabled=t(s),E.disabled=t(s)}),J(A,()=>t(l),n=>u(l,n)),J(E,()=>t(f),n=>u(f,n)),v(p,S)},o=p=>{var S=he();v(p,S)};O(e,p=>{h?p(r):p(o,!1)},a)}};O(ee,e=>{B?e(te):e(ae,!1)})}v($,I),de()}export{$e as component,ke as universal};
