import{g as oe,n as C,C as Pe,r as te,B as ae,e as se}from"../chunks/DHXfWtOE.js";import{f as x,a as g,s as A,t as re}from"../chunks/BzJ4SX3Z.js";import{p as Fe,q as w,k as E,v as Le,s as c,f as ne,a as Re,l as t,o as d,c as l,r,t as P,n as O,m as G}from"../chunks/CK57Ve49.js";import{i as M}from"../chunks/_0x7LJxc.js";import{b as ie}from"../chunks/DgwUmPXI.js";import{S as Ee}from"../chunks/hsiICLzS.js";const Oe=async({fetch:D,params:b})=>{try{const n=b.id,u=oe(D),[v,S,m]=await Promise.all([u.sets.get(n),u.songs.list(),u.script.getOpenTabs()]);return{set:v,songs:S,tabs:m}}catch(n){return{set:void 0,songs:{},tabs:{activeIndex:-1,tabs:[]},error:n instanceof Error?n.message:"An unknown error occurred."}}},Ke=Object.freeze(Object.defineProperty({__proto__:null,load:Oe},Symbol.toStringTag,{value:"Module"}));var Me=x('<p style="color: red;"> </p>'),De=x('<li class="dirty-tab svelte-nseja8"><span class="tab-name svelte-nseja8"> </span> <span class="tab-index svelte-nseja8"> </span></li>'),Be=x('<div class="warning-container svelte-nseja8"><div class="warning-message svelte-nseja8"><h3 class="svelte-nseja8">⚠️ Unsaved Changes Detected</h3> <p class="svelte-nseja8"> </p> <div class="dirty-tabs-list svelte-nseja8"><p class="svelte-nseja8"><strong>Tabs with unsaved changes:</strong></p> <ul class="dirty-tabs svelte-nseja8"></ul></div> <p class="svelte-nseja8"><strong>What to do:</strong></p> <ul class="svelte-nseja8"><li class="svelte-nseja8">Save your changes in Reaper, then click "Check Again" below</li> <li class="svelte-nseja8">Or disable "Replace existing tabs" to keep your current tabs</li></ul> <!></div></div>'),Ie=x('<div class="steps-container svelte-nseja8"></div>'),Ne=x('<div class="options-container svelte-nseja8"><label class="checkbox-label svelte-nseja8"><input type="checkbox" class="svelte-nseja8"/> Replace existing tabs (close all tabs before loading)</label> <label class="checkbox-label svelte-nseja8"><input type="checkbox" class="svelte-nseja8"/> Move playhead to start for each song</label></div> <div class="load-button-container svelte-nseja8"><!></div> <!> <!>',1),Ue=x("<p>Set not found.</p>"),qe=x("<meta:head><title>Load Set - Reaper Setlist</title></meta:head> <h1>Load Set</h1> <!>",1);function Qe(D,b){Fe(b,!0);let n=w(!1),u=w(!1),v=w(!0),S=w(!0),m=w(E(b.data.tabs.tabs)),j=E(b.data.set),le=E(b.data.songs),ce=G(()=>t(m).some(e=>e.dirty)),F=w(!1),H=G(()=>t(v)&&t(ce));const J=b.data.error,T=oe();let y=w(E([]));Le(()=>{j&&!t(n)&&!t(u)&&K(),t(v),t(S)});function K(){if(!j)return;const e=[];t(v)&&e.push({id:"close-all-tabs",title:"Close All Tabs",description:"Close all existing tabs in Reaper before loading the setlist",status:"pending",action:()=>ve()}),j.songs.forEach((a,s)=>{const p=le[a];(s>0||!t(v))&&e.push({id:s===0?"open-new-tab-initial":`new-tab-${s}`,title:"Open New Tab",description:s===0?"Create a new tab in Reaper for the setlist":`Create a new tab in Reaper for ${p.name}`,status:"pending",action:()=>ue()}),e.push({id:`load-song-${a}`,title:`Load ${p.name}`,description:`Load the project file for ${p.name}`,status:"pending",action:()=>de(p)}),t(S)&&e.push({id:`go-to-start-${s}`,title:"Move Playhead to Start",description:`Position the playhead at the beginning of ${p.name}`,status:"pending",action:()=>pe()})}),j.songs.length>0&&e.push({id:"switch-to-first-song",title:"Switch to First Song",description:"Navigate to the first song tab in the setlist",status:"pending",action:()=>fe()}),d(y,e,!0)}async function de(e){try{return await T.script.openProject(e.path),!0}catch(a){return C.error(`Failed to load song "${e.name}": ${a.message}`),!1}}async function ue(){try{return await T.reaper.newTab(),!0}catch(e){return C.error(`Failed to open new tab: ${e.message}`),!1}}async function ve(){try{return await T.reaper.closeAllTabs(),!0}catch(e){return C.error(`Failed to close all tabs: ${e.message}`),!1}}async function pe(){try{return await T.reaper.goToStart(),!0}catch(e){return C.error(`Failed to move playhead to start: ${e.message}`),!1}}async function fe(){try{let e;if(t(v)?e=0:e=b.data.tabs.tabs.length,e>0){const a=Array(e).fill(0).map(()=>Pe.nextTab());await T.reaper.executeCommands(a)}return!0}catch(e){return C.error(`Failed to switch to first song: ${e.message}`),!1}}function B(e,a){const s=t(y).findIndex(p=>p.id===e);s!==-1&&(t(y)[s].status=a)}async function ge(e){B(e.id,"running");try{let a=!1;return a=await e.action(),B(e.id,a?"completed":"error"),a}catch(a){return console.error(`Error executing step ${e.id}:`,a),B(e.id,"error"),!1}}async function be(){if(!t(F)){d(F,!0);try{const e=await T.script.getOpenTabs();d(m,e.tabs,!0)}catch(e){C.error(`Failed to refresh tabs: ${e.message}`)}finally{d(F,!1)}}}async function he(){if(!(!j||t(n))&&(t(u)&&(d(u,!1),K()),t(y).length!==0)){d(n,!0),d(u,!0);try{for(const e of t(y))await ge(e)||console.warn(`Step ${e.id} failed, but continuing...`),await new Promise(s=>setTimeout(s,200))}catch(e){console.error("Error during setlist loading:",e)}finally{d(n,!1)}}}var Q=qe(),me=c(ne(Q),4);{var ye=e=>{var a=Me(),s=l(a,!0);r(a),P(()=>A(s,J)),g(e,a)},_e=(e,a)=>{{var s=k=>{var R=Ne(),I=ne(R),N=l(I),U=l(N);te(U),O(),r(N);var V=c(N,2),q=l(V);te(q),O(),r(V),r(I);var z=c(I,2),we=l(z);const xe=G(()=>t(n)||t(H));ae(we,{onclick:he,get disabled(){return t(xe)},children:(i,h)=>{O();var f=re();P(()=>A(f,t(n)?"Loading...":t(u)?"Load Again":"Load Set")),g(i,f)},$$slots:{default:!0}}),r(z);var X=c(z,2);{var Se=i=>{var h=Be(),f=l(h),_=c(l(f),2),ke=l(_);r(_);var W=c(_,2),Z=c(l(W),2);se(Z,21,()=>t(m).filter(o=>o.dirty),o=>o.index,(o,L)=>{var $=De(),Y=l($),Ce=l(Y,!0);r(Y);var ee=c(Y,2),Ae=l(ee);r(ee),r($),P(()=>{A(Ce,t(L).name||"Untitled"),A(Ae,`(Tab ${t(L).index+1})`)}),g(o,$)}),r(Z),r(W);var $e=c(W,6);ae($e,{onclick:be,get disabled(){return t(F)},variant:"text",children:(o,L)=>{O();var $=re();P(()=>A($,t(F)?"Checking...":"Check Again")),g(o,$)},$$slots:{default:!0}}),r(f),r(h),P((o,L)=>A(ke,`You have unsaved changes in ${o??""} tab${L??""}. Since "Replace
					existing tabs" is enabled, these changes will be lost when loading the set.`),[()=>t(m).filter(o=>o.dirty).length,()=>t(m).filter(o=>o.dirty).length===1?"":"s"]),g(i,h)};M(X,i=>{t(H)&&i(Se)})}var je=c(X,2);{var Te=i=>{var h=Ie();se(h,21,()=>t(y),f=>f.id,(f,_)=>{Ee(f,{get title(){return t(_).title},get description(){return t(_).description},get status(){return t(_).status}})}),r(h),g(i,h)};M(je,i=>{t(y).length>0&&i(Te)})}P(()=>{U.disabled=t(n),q.disabled=t(n)}),ie(U,()=>t(v),i=>d(v,i)),ie(q,()=>t(S),i=>d(S,i)),g(k,R)},p=k=>{var R=Ue();g(k,R)};M(e,k=>{j?k(s):k(p,!1)},a)}};M(me,e=>{J?e(ye):e(_e,!1)})}g(D,Q),Re()}export{Qe as component,Ke as universal};
