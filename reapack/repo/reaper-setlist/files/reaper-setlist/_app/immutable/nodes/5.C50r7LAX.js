import{g as le,n as C,C as te,r as ae,B as se,e as re}from"../chunks/DHXfWtOE.js";import{f as j,a as h,s as A,t as ne}from"../chunks/BzJ4SX3Z.js";import{p as Pe,q as S,k as R,v as Fe,s as p,f as ie,a as Oe,l as t,o as d,c,r as n,t as L,n as E,m as G}from"../chunks/CK57Ve49.js";import{i as I}from"../chunks/_0x7LJxc.js";import{b as oe}from"../chunks/DgwUmPXI.js";import{S as Re}from"../chunks/hsiICLzS.js";const Ee=async({fetch:M,params:m})=>{try{const i=m.id,v=le(M),[f,T,y]=await Promise.all([v.sets.get(i),v.songs.list(),v.script.getOpenTabs()]);return{set:f,songs:T,tabs:y}}catch(i){return{set:void 0,songs:{},tabs:{activeIndex:-1,tabs:[]},error:i instanceof Error?i.message:"An unknown error occurred."}}},Ke=Object.freeze(Object.defineProperty({__proto__:null,load:Ee},Symbol.toStringTag,{value:"Module"}));var Ie=j('<p style="color: red;"> </p>'),Me=j('<li class="dirty-tab svelte-nseja8"><span class="tab-name svelte-nseja8"> </span> <span class="tab-index svelte-nseja8"> </span></li>'),Be=j('<div class="warning-container svelte-nseja8"><div class="warning-message svelte-nseja8"><h3 class="svelte-nseja8">⚠️ Unsaved Changes Detected</h3> <p class="svelte-nseja8"> </p> <div class="dirty-tabs-list svelte-nseja8"><p class="svelte-nseja8"><strong>Tabs with unsaved changes:</strong></p> <ul class="dirty-tabs svelte-nseja8"></ul></div> <p class="svelte-nseja8"><strong>What to do:</strong></p> <ul class="svelte-nseja8"><li class="svelte-nseja8">Save your changes in Reaper, then click "Check Again" below</li> <li class="svelte-nseja8">Or disable "Replace existing tabs" to keep your current tabs</li></ul> <!></div></div>'),De=j('<div class="steps-container svelte-nseja8"></div>'),Ne=j('<div class="options-container svelte-nseja8"><label class="checkbox-label svelte-nseja8"><input type="checkbox" class="svelte-nseja8"/> Replace existing tabs (close all tabs before loading)</label> <label class="checkbox-label svelte-nseja8"><input type="checkbox" class="svelte-nseja8"/> Move playhead to start for each song</label></div> <div class="load-button-container svelte-nseja8"><!></div> <!> <!>',1),Ue=j("<p>Set not found.</p>"),qe=j("<meta:head><title>Load Set - Reaper Setlist</title></meta:head> <h1>Load Set</h1> <!>",1);function Qe(M,m){Pe(m,!0);let i=S(!1),v=S(!1),f=S(!0),T=S(!0),y=S(R(m.data.tabs.tabs)),k=R(m.data.set),ce=R(m.data.songs),de=G(()=>t(y).some(e=>e.dirty)),P=S(!1),H=G(()=>t(f)&&t(de));const J=m.data.error,g=le();let w=S(R([]));Fe(()=>{k&&!t(i)&&!t(v)&&K(),t(f),t(T)});function K(){if(!k)return;const e=[];t(f)&&e.push({id:"close-all-tabs",title:"Close All Tabs",description:"Close all existing tabs in Reaper before loading the setlist",status:"pending",action:()=>ve()}),k.songs.forEach((a,s)=>{const r=ce[a];(s>0||!t(f))&&e.push({id:s===0?"open-new-tab-initial":`new-tab-${s}`,title:"Open New Tab",description:s===0?"Create a new tab in Reaper for the setlist":`Create a new tab in Reaper for ${r.name}`,status:"pending",action:()=>pe()}),e.push({id:`load-song-${a}`,title:`Load ${r.name}`,description:`Load the project file for ${r.name}`,status:"pending",action:()=>ue(r)}),t(T)&&e.push({id:`go-to-start-${s}`,title:"Move Playhead to Start",description:`Position the playhead at the beginning of ${r.name}`,status:"pending",action:()=>fe()})}),k.songs.length>0&&e.push({id:"switch-to-first-song",title:"Switch to First Song",description:"Navigate to the first song tab in the setlist",status:"pending",action:()=>ge()}),d(w,e,!0)}async function ue(e){try{return await g.script.openProject(e.path),!0}catch(a){return C.error(`Failed to load song "${e.name}": ${a.message}`),!1}}async function pe(){try{return await g.reaper.newTab(),!0}catch(e){return C.error(`Failed to open new tab: ${e.message}`),!1}}async function ve(){try{return await g.reaper.closeAllTabs(),!0}catch(e){return C.error(`Failed to close all tabs: ${e.message}`),!1}}async function fe(){try{return await g.reaper.goToStart(),!0}catch(e){return C.error(`Failed to move playhead to start: ${e.message}`),!1}}async function ge(){try{let e;const s=(await g.script.getOpenTabs()).activeIndex;t(f)?e=0:e=m.data.tabs.tabs.length;const r=e-s;if(r>0){const u=Array(r).fill(0).map(()=>te.nextTab());await g.reaper.executeCommands(u)}else if(r<0){const u=Array(-r).fill(0).map(()=>te.previousTab());await g.reaper.executeCommands(u)}return!0}catch(e){return C.error(`Failed to switch to first song: ${e.message}`),!1}}function B(e,a){const s=t(w).findIndex(r=>r.id===e);s!==-1&&(t(w)[s].status=a)}async function be(e){B(e.id,"running");try{let a=!1;return a=await e.action(),B(e.id,a?"completed":"error"),a}catch(a){return console.error(`Error executing step ${e.id}:`,a),B(e.id,"error"),!1}}async function he(){if(!t(P)){d(P,!0);try{const e=await g.script.getOpenTabs();d(y,e.tabs,!0)}catch(e){C.error(`Failed to refresh tabs: ${e.message}`)}finally{d(P,!1)}}}async function me(){if(!(!k||t(i))&&(t(v)&&(d(v,!1),K()),t(w).length!==0)){d(y,(await g.script.getOpenTabs()).tabs,!0),d(i,!0),d(v,!0);try{for(const e of t(w))await be(e)||console.warn(`Step ${e.id} failed, but continuing...`),await new Promise(s=>setTimeout(s,200))}catch(e){console.error("Error during setlist loading:",e)}finally{d(i,!1)}}}var Q=qe(),ye=p(ie(Q),4);{var _e=e=>{var a=Ie(),s=c(a,!0);n(a),L(()=>A(s,J)),h(e,a)},we=(e,a)=>{{var s=u=>{var O=Ne(),D=ie(O),N=c(D),U=c(N);ae(U),E(),n(N);var V=p(N,2),q=c(V);ae(q),E(),n(V),n(D);var z=p(D,2),xe=c(z);const Se=G(()=>t(i)||t(H));se(xe,{onclick:me,get disabled(){return t(Se)},children:(o,_)=>{E();var b=ne();L(()=>A(b,t(i)?"Loading...":t(v)?"Load Again":"Load Set")),h(o,b)},$$slots:{default:!0}}),n(z);var X=p(z,2);{var je=o=>{var _=Be(),b=c(_),x=p(c(b),2),$e=c(x);n(x);var W=p(x,2),Z=p(c(W),2);re(Z,21,()=>t(y).filter(l=>l.dirty),l=>l.index,(l,F)=>{var $=Me(),Y=c($),Ae=c(Y,!0);n(Y);var ee=p(Y,2),Le=c(ee);n(ee),n($),L(()=>{A(Ae,t(F).name||"Untitled"),A(Le,`(Tab ${t(F).index+1})`)}),h(l,$)}),n(Z),n(W);var Ce=p(W,6);se(Ce,{onclick:he,get disabled(){return t(P)},variant:"text",children:(l,F)=>{E();var $=ne();L(()=>A($,t(P)?"Checking...":"Check Again")),h(l,$)},$$slots:{default:!0}}),n(b),n(_),L((l,F)=>A($e,`You have unsaved changes in ${l??""} tab${F??""}.
					Since "Replace existing tabs" is enabled, these changes will be lost when loading the set.`),[()=>t(y).filter(l=>l.dirty).length,()=>t(y).filter(l=>l.dirty).length===1?"":"s"]),h(o,_)};I(X,o=>{t(H)&&o(je)})}var Te=p(X,2);{var ke=o=>{var _=De();re(_,21,()=>t(w),b=>b.id,(b,x)=>{Re(b,{get title(){return t(x).title},get description(){return t(x).description},get status(){return t(x).status}})}),n(_),h(o,_)};I(Te,o=>{t(w).length>0&&o(ke)})}L(()=>{U.disabled=t(i),q.disabled=t(i)}),oe(U,()=>t(f),o=>d(f,o)),oe(q,()=>t(T),o=>d(T,o)),h(u,O)},r=u=>{var O=Ue();h(u,O)};I(e,u=>{k?u(s):u(r,!1)},a)}};I(ye,e=>{J?e(_e):e(we,!1)})}h(M,Q),Oe()}export{Qe as component,Ke as universal};
