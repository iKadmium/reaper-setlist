var ne=Object.defineProperty;var Tt=s=>{throw TypeError(s)};var ae=(s,t,e)=>t in s?ne(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e;var I=(s,t,e)=>ae(s,typeof t!="symbol"?t+"":t,e),ie=(s,t,e)=>t.has(s)||Tt("Cannot "+e);var z=(s,t,e)=>(ie(s,t,"read from private field"),e?e.call(s):t.get(s)),nt=(s,t,e)=>t.has(s)?Tt("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(s):t.set(s,e);import{d as tt,l as P,ap as oe,Q as Ut,e as Y,g as ce,aq as at,am as Vt,y as bt,Z as le,ar as xt,h as b,as as ue,al as fe,at as de,au as mt,av as vt,aw as he,ax as q,b as pe,a8 as Ht,K as me,M as ve,N as Et,O as it,P as H,i as F,ai as ge,ab as we,ac as Se,a9 as Ce,ay as Gt,G as _e,az as At,aA as ye,E as Re,x as dt,A as gt,aB as Te,aC as be,u as xe,aD as Ee,aE as Ae,X as Ie,aF as Pe,aG as ke,aH as Oe,aI as Ne,q as Z,k as qt,o as K,p as Me,f as It,a as Le,c as Pt,r as kt,t as Ot,m as je}from"./CK57Ve49.js";import{l as Fe,j as Ke,k as De,d as Xt,n as ze,o as Be,p as Ue,q as Ve,b as He,a as V,g as Nt,f as Jt}from"./BzJ4SX3Z.js";import{r as Ge,p as qe,i as Mt,b as Lt}from"./_0x7LJxc.js";let ot=null;function Ks(s,t){return t}function Xe(s,t,e,r){for(var n=[],a=t.length,i=0;i<a;i++)ue(t[i].e,n,!0);var o=a>0&&n.length===0&&e!==null;if(o){var f=e.parentNode;fe(f),f.append(e),r.clear(),j(s,t[0].prev,t[a-1].next)}de(n,()=>{for(var d=0;d<a;d++){var v=t[d];o||(r.delete(v.k),j(s,v.prev,v.next)),q(v.e,!o)}})}function Ds(s,t,e,r,n,a=null){var i=s,o={flags:t,items:new Map,first:null},f=(t&Gt)!==0;if(f){var d=s;i=b?it(Se(d)):d.appendChild(Ce())}b&&pe();var v=null,g=!1,l=oe(()=>{var c=e();return Ht(c)?c:c==null?[]:Vt(c)});tt(()=>{var c=P(l),m=c.length;if(g&&m===0)return;g=m===0;let w=!1;if(b){var y=me(i)===ve;y!==(m===0)&&(i=Et(),it(i),H(!1),w=!0)}if(b){for(var S=null,_,h=0;h<m;h++){if(F.nodeType===8&&F.data===ge){i=F,w=!0,H(!1);break}var u=c[h],p=r(u,h);_=Yt(F,o,S,null,u,p,h,n,t,e),o.items.set(p,_),S=_}m>0&&it(Et())}b||Je(c,o,i,n,t,r,e),a!==null&&(m===0?v?Ut(v):v=Y(()=>a(i)):v!==null&&ce(v,()=>{v=null})),w&&H(!0),P(l)}),b&&(i=F)}function Je(s,t,e,r,n,a,i){var St,Ct,_t,yt;var o=(n&ye)!==0,f=(n&(vt|mt))!==0,d=s.length,v=t.items,g=t.first,l=g,c,m=null,w,y=[],S=[],_,h,u,p;if(o)for(p=0;p<d;p+=1)_=s[p],h=a(_,p),u=v.get(h),u!==void 0&&((St=u.a)==null||St.measure(),(w??(w=new Set)).add(u));for(p=0;p<d;p+=1){if(_=s[p],h=a(_,p),u=v.get(h),u===void 0){var N=l?l.e.nodes_start:e;m=Yt(N,t,m,m===null?t.first:m.next,_,h,p,r,n,i),v.set(h,m),y=[],S=[],l=m.next;continue}if(f&&Ye(u,_,p,n),(u.e.f&at)!==0&&(Ut(u.e),o&&((Ct=u.a)==null||Ct.unfix(),(w??(w=new Set)).delete(u))),u!==l){if(c!==void 0&&c.has(u)){if(y.length<S.length){var T=S[0],k;m=T.prev;var $=y[0],st=y[y.length-1];for(k=0;k<y.length;k+=1)jt(y[k],T,e);for(k=0;k<S.length;k+=1)c.delete(S[k]);j(t,$.prev,st.next),j(t,m,$),j(t,st,T),l=T,m=st,p-=1,y=[],S=[]}else c.delete(u),jt(u,l,e),j(t,u.prev,u.next),j(t,u,m===null?t.first:m.next),j(t,m,u),m=u;continue}for(y=[],S=[];l!==null&&l.k!==h;)(l.e.f&at)===0&&(c??(c=new Set)).add(l),S.push(l),l=l.next;if(l===null)continue;u=l}y.push(u),m=u,l=u.next}if(l!==null||c!==void 0){for(var D=c===void 0?[]:Vt(c);l!==null;)(l.e.f&at)===0&&D.push(l),l=l.next;var rt=D.length;if(rt>0){var re=(n&Gt)!==0&&d===0?e:null;if(o){for(p=0;p<rt;p+=1)(_t=D[p].a)==null||_t.measure();for(p=0;p<rt;p+=1)(yt=D[p].a)==null||yt.fix()}Xe(t,D,re,v)}}o&&_e(()=>{var Rt;if(w!==void 0)for(u of w)(Rt=u.a)==null||Rt.apply()}),bt.first=t.first&&t.first.e,bt.last=m&&m.e}function Ye(s,t,e,r){(r&vt)!==0&&At(s.v,t),(r&mt)!==0?At(s.i,e):s.i=e}function Yt(s,t,e,r,n,a,i,o,f,d){var v=ot,g=(f&vt)!==0,l=(f&he)===0,c=g?l?le(n,!1,!1):xt(n):n,m=(f&mt)===0?i:xt(i),w={i:m,v:c,k:a,a:null,e:null,prev:e,next:r};ot=w;try{return w.e=Y(()=>o(s,c,m,d),b),w.e.prev=e&&e.e,w.e.next=r&&r.e,e===null?t.first=w:(e.next=w,e.e.next=w.e),r!==null&&(r.prev=w,r.e.prev=w.e),w}finally{ot=v}}function jt(s,t,e){for(var r=s.next?s.next.e.nodes_start:e,n=t?t.e.nodes_start:e,a=s.e.nodes_start;a!==r;){var i=we(a);n.before(a),a=i}}function j(s,t,e){t===null?s.first=e:(t.next=e,t.e.next=e&&e.e),e!==null&&(e.prev=t,e.e.prev=t&&t.e)}function Ft(s,t,...e){var r=s,n=dt,a;tt(()=>{n!==(n=t())&&(a&&(q(a),a=null),a=Y(()=>n(r,...e)))},Re),b&&(r=F)}function $e(s,t){var e=void 0,r;tt(()=>{e!==(e=t())&&(r&&(q(r),r=null),e&&(r=Y(()=>{gt(()=>e(s))})))})}function $t(s){var t,e,r="";if(typeof s=="string"||typeof s=="number")r+=s;else if(typeof s=="object")if(Array.isArray(s)){var n=s.length;for(t=0;t<n;t++)s[t]&&(e=$t(s[t]))&&(r&&(r+=" "),r+=e)}else for(e in s)s[e]&&(r&&(r+=" "),r+=e);return r}function We(){for(var s,t,e=0,r="",n=arguments.length;e<n;e++)(s=arguments[e])&&(t=$t(s))&&(r&&(r+=" "),r+=t);return r}function Ze(s){return typeof s=="object"?We(s):s??""}const Kt=[...` 	
\r\fÂ \v\uFEFF`];function Qe(s,t,e){var r=s==null?"":""+s;if(t&&(r=r?r+" "+t:t),e){for(var n in e)if(e[n])r=r?r+" "+n:n;else if(r.length)for(var a=n.length,i=0;(i=r.indexOf(n,i))>=0;){var o=i+a;(i===0||Kt.includes(r[i-1]))&&(o===r.length||Kt.includes(r[o]))?r=(i===0?"":r.substring(0,i))+r.substring(o+1):i=o}}return r===""?null:r}function Dt(s,t=!1){var e=t?" !important;":";",r="";for(var n in s){var a=s[n];a!=null&&a!==""&&(r+=" "+n+": "+a+e)}return r}function ct(s){return s[0]!=="-"||s[1]!=="-"?s.toLowerCase():s}function ts(s,t){if(t){var e="",r,n;if(Array.isArray(t)?(r=t[0],n=t[1]):r=t,s){s=String(s).replaceAll(/\s*\/\*.*?\*\/\s*/g,"").trim();var a=!1,i=0,o=!1,f=[];r&&f.push(...Object.keys(r).map(ct)),n&&f.push(...Object.keys(n).map(ct));var d=0,v=-1;const w=s.length;for(var g=0;g<w;g++){var l=s[g];if(o?l==="/"&&s[g-1]==="*"&&(o=!1):a?a===l&&(a=!1):l==="/"&&s[g+1]==="*"?o=!0:l==='"'||l==="'"?a=l:l==="("?i++:l===")"&&i--,!o&&a===!1&&i===0){if(l===":"&&v===-1)v=g;else if(l===";"||g===w-1){if(v!==-1){var c=ct(s.substring(d,v).trim());if(!f.includes(c)){l!==";"&&g++;var m=s.substring(d,g).trim();e+=" "+m+";"}}d=g+1,v=-1}}}}return r&&(e+=Dt(r)),n&&(e+=Dt(n,!0)),e=e.trim(),e===""?null:e}return s==null?null:String(s)}function ht(s,t,e,r,n,a){var i=s.__className;if(b||i!==e||i===void 0){var o=Qe(e,r,a);(!b||o!==s.getAttribute("class"))&&(o==null?s.removeAttribute("class"):t?s.className=o:s.setAttribute("class",o)),s.__className=e}else if(a&&n!==a)for(var f in a){var d=!!a[f];(n==null||d!==!!n[f])&&s.classList.toggle(f,d)}return a}function lt(s,t={},e,r){for(var n in e){var a=e[n];t[n]!==a&&(e[n]==null?s.style.removeProperty(n):s.style.setProperty(n,a,r))}}function pt(s,t,e,r){var n=s.__style;if(b||n!==t){var a=ts(t,r);(!b||a!==s.getAttribute("style"))&&(a==null?s.removeAttribute("style"):s.style.cssText=a),s.__style=t}else r&&(Array.isArray(r)?(lt(s,e==null?void 0:e[0],r[0]),lt(s,e==null?void 0:e[1],r[1],"important")):lt(s,e,r));return r}function Q(s,t,e){if(s.multiple){if(t==null)return;if(!Ht(t))return Te();for(var r of s.options)r.selected=t.includes(G(r));return}for(r of s.options){var n=G(r);if(be(n,t)){r.selected=!0;return}}(!e||t!==void 0)&&(s.selectedIndex=-1)}function Wt(s,t){let e=!0;gt(()=>{t&&Q(s,xe(t),e),e=!1;var r=new MutationObserver(()=>{var n=s.__value;Q(s,n)});return r.observe(s,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),()=>{r.disconnect()}})}function zs(s,t,e=t){var r=!0;Fe(s,"change",n=>{var a=n?"[selected]":":checked",i;if(s.multiple)i=[].map.call(s.querySelectorAll(a),G);else{var o=s.querySelector(a)??s.querySelector("option:not([disabled])");i=o&&G(o)}e(i)}),gt(()=>{var n=t();if(Q(s,n,r),r&&n===void 0){var a=s.querySelector(":checked");a!==null&&(n=G(a),e(n))}s.__value=n,r=!1}),Wt(s)}function G(s){return"__value"in s?s.__value:s.value}const B=Symbol("class"),U=Symbol("style"),Zt=Symbol("is custom element"),Qt=Symbol("is html");function Bs(s){if(b){var t=!1,e=()=>{if(!t){if(t=!0,s.hasAttribute("value")){var r=s.value;O(s,"value",null),s.value=r}if(s.hasAttribute("checked")){var n=s.checked;O(s,"checked",null),s.checked=n}}};s.__on_r=e,ke(e),Ue()}}function Us(s,t){var e=wt(s);e.value===(e.value=t??void 0)||s.value===t&&(t!==0||s.nodeName!=="PROGRESS")||(s.value=t??"")}function es(s,t){t?s.hasAttribute("selected")||s.setAttribute("selected",""):s.removeAttribute("selected")}function O(s,t,e,r){var n=wt(s);b&&(n[t]=s.getAttribute(t),t==="src"||t==="srcset"||t==="href"&&s.nodeName==="LINK")||n[t]!==(n[t]=e)&&(t==="loading"&&(s[Oe]=e),e==null?s.removeAttribute(t):typeof e!="string"&&te(s).includes(t)?s[t]=e:s.setAttribute(t,e))}function ss(s,t,e,r,n=!1){var a=wt(s),i=a[Zt],o=!a[Qt];let f=b&&i;f&&H(!1);var d=t||{},v=s.tagName==="OPTION";for(var g in t)g in e||(e[g]=null);e.class?e.class=Ze(e.class):e[B]&&(e.class=null),e[U]&&(e.style??(e.style=null));var l=te(s);for(const h in e){let u=e[h];if(v&&h==="value"&&u==null){s.value=s.__value="",d[h]=u;continue}if(h==="class"){var c=s.namespaceURI==="http://www.w3.org/1999/xhtml";ht(s,c,u,r,t==null?void 0:t[B],e[B]),d[h]=u,d[B]=e[B];continue}if(h==="style"){pt(s,u,t==null?void 0:t[U],e[U]),d[h]=u,d[U]=e[U];continue}var m=d[h];if(u!==m){d[h]=u;var w=h[0]+h[1];if(w!=="$$")if(w==="on"){const p={},N="$$"+h;let T=h.slice(2);var y=Ve(T);if(Ke(T)&&(T=T.slice(0,-7),p.capture=!0),!y&&m){if(u!=null)continue;s.removeEventListener(T,d[N],p),d[N]=null}if(u!=null)if(y)s[`__${T}`]=u,Xt([T]);else{let k=function($){d[h].call(this,$)};d[N]=De(T,s,k,p)}else y&&(s[`__${T}`]=void 0)}else if(h==="style")O(s,h,u);else if(h==="autofocus")ze(s,!!u);else if(!i&&(h==="__value"||h==="value"&&u!=null))s.value=s.__value=u;else if(h==="selected"&&v)es(s,u);else{var S=h;o||(S=Be(S));var _=S==="defaultValue"||S==="defaultChecked";if(u==null&&!i&&!_)if(a[h]=null,S==="value"||S==="checked"){let p=s;const N=t===void 0;if(S==="value"){let T=p.defaultValue;p.removeAttribute(S),p.defaultValue=T,p.value=p.__value=N?T:null}else{let T=p.defaultChecked;p.removeAttribute(S),p.defaultChecked=T,p.checked=N?T:!1}}else s.removeAttribute(h);else _||l.includes(S)&&(i||typeof u!="string")?s[S]=u:typeof u!="function"&&O(s,S,u)}}}return f&&H(!0),d}function rs(s,t,e=[],r,n=!1,a=Ie){const i=e.map(a);var o=void 0,f={},d=s.nodeName==="SELECT",v=!1;tt(()=>{var g=t(...i.map(P));ss(s,o,g,r,n),v&&d&&"value"in g&&Q(s,g.value,!1);for(let c of Object.getOwnPropertySymbols(f))g[c]||q(f[c]);for(let c of Object.getOwnPropertySymbols(g)){var l=g[c];c.description===Pe&&(!o||l!==o[c])&&(f[c]&&q(f[c]),f[c]=Y(()=>$e(s,()=>l)))}o=g}),d&&Wt(s,()=>o.value),v=!0}function wt(s){return s.__attributes??(s.__attributes={[Zt]:s.nodeName.includes("-"),[Qt]:s.namespaceURI===Ee})}var zt=new Map;function te(s){var t=zt.get(s.nodeName);if(t)return t;zt.set(s.nodeName,t=[]);for(var e,r=s,n=Element.prototype;n!==r;){e=Ne(r);for(var a in e)e[a].set&&t.push(a);r=Ae(r)}return t}function Vs(s){const t=Math.floor(s/60),e=Math.floor(s%60);return`${t}:${e.toString().padStart(2,"0")}`}function ee(){return typeof crypto<"u"&&crypto.randomUUID?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(s){const t=Math.random()*16|0;return(s==="x"?t:t&3|8).toString(16)})}var X;class ns{constructor(){nt(this,X,Z(qt([])))}get notifications(){return P(z(this,X))}set notifications(t){K(z(this,X),t,!0)}get items(){return this.notifications}add(t,e="primary",r){const n=ee(),a={id:n,message:t,type:e,duration:r,timestamp:new Date};return this.notifications=[...this.notifications,a],r!==void 0&&setTimeout(()=>{this.remove(n)},r),n}remove(t){this.notifications=this.notifications.filter(e=>e.id!==t)}clear(){this.notifications=[]}success(t,e=5e3){return this.add(t,"success",e)}error(t,e){return this.add(t,"delete",e)}warning(t,e=7e3){return this.add(t,"edit",e)}info(t,e=5e3){return this.add(t,"primary",e)}}X=new WeakMap;const Hs=new ns,as="Operation",W={ProjectRoot:"ProjectRoot",ScriptActionId:"ScriptActionId"},R={ReaperSetlist:"ReaperSetlist",Songs:"ReaperSetlist.Songs",Sets:"ReaperSetlist.Sets"};class et{}class is extends et{parseResponse(t){if(!t)throw new Error("Empty transport response");const e=t.split("	");if(e.length!==6)throw new Error(`Unexpected transport format: ${t}`);return{playState:parseInt(e[1],10),positionSeconds:parseFloat(e[2]),repeatOn:e[3]==="1",positionString:e[4],positionStringBeats:e[5]}}getResponseMarker(){return"TRANSPORT"}async getCommandString(){return Promise.resolve("TRANSPORT")}}class os extends et{parseResponse(t){const e=[];for(const r of t){if(r.startsWith("MARKER_LIST"))continue;if(r.startsWith("MARKER_LIST_END"))break;const n=r.split("	");if(n.length<4)throw new Error(`Invalid marker line: ${r}`);const a={id:parseInt(n[2],10),name:n[1],position:parseFloat(n[3])};e.push(a)}return e}getResponseMarker(){return"MARKER_LIST"}async getCommandString(){return Promise.resolve("MARKER")}}class x extends et{parseResponse(t){}getResponseMarker(){}}class cs extends x{getCommandString(){return Promise.resolve("40042")}}class ls extends x{getCommandString(){return Promise.resolve("40859")}}class us extends x{getCommandString(){return Promise.resolve("40860")}}class fs extends x{getCommandString(){return Promise.resolve("40886")}}class ds extends x{getCommandString(){return Promise.resolve("40861")}}class hs extends x{getCommandString(){return Promise.resolve("40862")}}class ps extends x{getCommandString(){return Promise.resolve("1007")}}class ms extends x{getCommandString(){return Promise.resolve("1008")}}class vs extends x{getCommandString(){return Promise.resolve("1016")}}class gs extends x{getCommandString(){return Promise.resolve("1013")}}class M extends x{async getCommandString(){if(await ft.ensureInitialized(),!ft.scriptActionId)throw new Error("Script action ID is not set. Please configure it in the settings.");return ft.scriptActionId}}class ws extends x{constructor(t){super(),this.markerId=t}async getCommandString(){return Promise.resolve(`SET/POS_STR/m${this.markerId}`)}}class E extends x{constructor(t,e,r,n=!1){super(),this.section=t,this.key=e,this.value=r,this.persist=n}async getCommandString(){const t=this.persist?"SET/EXTSTATEPERSIST":"SET/EXTSTATE",e=encodeURIComponent(this.value);return Promise.resolve(`${t}/${this.section}/${this.key}/${e}`)}}class L extends E{constructor(t){super(R.ReaperSetlist,as,t,!1)}}class A extends et{constructor(t,e,r=!0){super(),this.section=t,this.key=e,this.temp=r}getCommandString(){const t=this.temp?"GET/EXTSTATE":"GET/EXTSTATE_PERSIST";return Promise.resolve(`${t}/${this.section}/${this.key}`)}parseResponse(t){if(!t||t.trim()==="")return;const e=t.trim(),r=e.split("	");if(r.length===4&&r[0]==="EXTSTATE"&&r[1]===this.section&&r[2]===this.key)return r[3];if(r.length===3&&r[0]==="EXTSTATE"&&r[1]===this.section&&r[2]===this.key)return;throw new Error(`Unexpected response format: ${e}`)}getResponseMarker(){return"EXTSTATE"}}const C={transport:()=>new is,markers:()=>new os,goToStart:()=>new cs,goToMarker:s=>new ws(s),newTab:()=>new ls,closeTab:()=>new us,closeAllTabs:()=>new fs,nextTab:()=>new ds,previousTab:()=>new hs,play:()=>new ps,pause:()=>new ms,stop:()=>new vs,record:()=>new gs},Ss=600;class Cs{constructor(t,e=globalThis.fetch){I(this,"urlRoot");I(this,"fetch");this.urlRoot=t,this.fetch=e}async executeCommand(t){const[e]=await this.executeCommands([t]);return e}async executeCommands(t){const e=await Promise.all(t.map(a=>a.getCommandString())),r=await this.sendRawCommands(e);return this.parseMultiCommandResponse(t,r)}parseMultiCommandResponse(t,e){const r=[];let n=0;for(const a of t){if(!a.getResponseMarker()){r.push(void 0);continue}const i=e[n];if(i.length===0)throw new Error(`Empty response for command: ${a.getCommandString()}`);const o=i.split("	")[0];if(o!==a.getResponseMarker())throw new Error(`Unexpected response type for command ${a.getCommandString()}: expected ${a.getResponseMarker()}, got ${o}`);if(a.getResponseMarker()==="MARKER_LIST"){const f=a.parseResponse(e.slice(n)),d=f;r.push(f),n+=d.length+1}else{const f=a.parseResponse(i);r.push(f)}n++}return r}async sendCommand(t){return this.sendRawCommand(t)}async sendCommands(t){return this.sendRawCommands(t)}async getTransport(){return this.executeCommand(C.transport())}async goToStart(){const[t,e]=await this.executeCommands([C.goToStart(),C.transport()]);return e}async play(){const[,t]=await this.executeCommands([C.play(),C.transport()]);return t}async pause(){const[,t]=await this.executeCommands([C.pause(),C.transport()]);return t}async stop(){const[,t]=await this.executeCommands([C.stop(),C.transport()]);return t}async record(){const[,t]=await this.executeCommands([C.record(),C.transport()]);return t}async closeTab(){await this.executeCommand(C.closeTab())}async newTab(){await this.executeCommand(C.newTab())}async closeAllTabs(){await this.executeCommand(C.closeAllTabs())}async nextTab(){const[,t,e]=await this.executeCommands([C.nextTab(),C.transport(),C.markers()]);return{markers:e,transport:t}}async previousTab(){const[,t,e]=await this.executeCommands([C.previousTab(),C.transport(),C.markers()]);return{markers:e,transport:t}}async getMarkers(){return this.executeCommand(C.markers())}async goToMarker(t){const[e,r]=await this.executeCommands([C.goToMarker(t),C.transport()]);return r}async playAndGetFullState(){const[t,e,r]=await this.executeCommands([C.play(),C.transport(),C.markers()]);return{playResult:t,transport:e,markers:r}}async sendRawCommand(t){const e=await this.fetch(`${this.urlRoot}/${t}`,{method:"GET"});if(!e.ok)throw new Error(`Failed to send command ${t}: ${e.statusText}`);return(await e.text()).split(`
`).filter(a=>a.trim()!=="")}async sendRawCommands(t){if(t.length===0)return[];const e=[],r=this.batchCommandsByUrlLength(t);for(const n of r){const a=`${this.urlRoot}/${n.join(";")}`,i=await this.fetch(a,{method:"GET"});if(!i.ok)throw new Error(`Failed to send commands ${n.join(",")}: ${i.statusText}`);const f=(await i.text()).split(`
`).slice(0,-1);e.push(...f)}return e}batchCommandsByUrlLength(t){const e=[];let r=[],n=this.urlRoot.length;for(const a of t){const o=(r.length>0?";":"").length+a.length;n+o>Ss&&r.length>0?(e.push([...r]),r=[a],n=this.urlRoot.length+a.length):(r.push(a),n+=o)}return r.length>0&&e.push(r),e}}class _s{}const ys=500,ut="__index__";class se extends _s{constructor(t,e,r){super(),this.apiClient=t,this.scriptClient=e,this.sectionKey=r}async fetchIndex(){const t=new A(this.sectionKey,ut),e=await this.apiClient.executeCommand(t);return e?JSON.parse(e):[]}async saveData(t,e){JSON.stringify(e).length<=ys?await this.apiClient.executeCommand(new E(this.sectionKey,t,JSON.stringify(e),!0)):await this.scriptClient.writeChunkedData(this.sectionKey,t,e)}async saveIndex(t){await this.saveData(ut,t)}async fetchById(t){const e=new A(this.sectionKey,t),r=await this.apiClient.executeCommand(e);return r?JSON.parse(r):void 0}async saveById(t,e){await this.saveData(t,e)}async deleteById(t){await this.scriptClient.deleteState(this.sectionKey,t)}async get(t){return this.fetchById(t)}async update(t,e){await this.saveById(t,e)}async add(t){const e=ee(),r={...t,id:e};await this.saveById(e,r);const n=await this.fetchIndex();return n.push(e),await this.saveIndex(n),r}async delete(t){await this.deleteById(t);const r=(await this.fetchIndex()).filter(n=>n!==t);await this.saveIndex(r)}async list(){const t=new A(this.sectionKey,ut),e=await this.apiClient.executeCommand(t);if(!e)return{};const r=JSON.parse(e),n={},a=r.map(o=>new A(this.sectionKey,o)),i=await this.apiClient.executeCommands(a);for(const o of i)if(o){const f=JSON.parse(o);n[f.id]=f}return n}}class Rs{constructor(t){this.apiClient=t}getChunkCommands(t,e){const r=[],n=JSON.stringify(e),a=500;for(let o=0;o<n.length;o+=a)r.push(n.slice(o,o+a));const i=[];i.push(new E(R.ReaperSetlist,`${t}_length`,r.length.toString()));for(let o=0;o<r.length;o++)i.push(new E(R.ReaperSetlist,`${t}_${o}`,r[o]));return i}async listProjects(){const t=[new L("listProjects"),new M,new A(R.ReaperSetlist,"projects")],[e,r,n]=await this.apiClient.executeCommands(t);if(n===void 0)throw new Error("Failed to retrieve projects. Please check the script configuration.");return JSON.parse(n)}async testProjectsFolder(t){const e=[new E(R.ReaperSetlist,"folderPath",t),new L("testProjectsFolder"),new M,new A(R.ReaperSetlist,"valid"),new A(R.ReaperSetlist,"message")],[r,n,a,i,o]=await this.apiClient.executeCommands(e);if(i===void 0)throw new Error("Failed to retrieve valid. Please check the script configuration.");const f=i==="true";if(o===void 0)throw new Error("Failed to retrieve message. Please check the script configuration.");return{valid:f,message:o}}async openProject(t){const e=[new E(R.ReaperSetlist,"projectPath",t),new L("openProject"),new M];await this.apiClient.executeCommands(e)}async testActionId(t){const e=[new E(R.ReaperSetlist,"testNonce",t),new L("testActionId"),new M,new A(R.ReaperSetlist,"testOutput")],[r,n,a,i]=await this.apiClient.executeCommands(e);if(i===void 0)throw new Error("Failed to retrieve testOutput. Please check the script configuration.");return i}async getProjectLength(){const t=[new L("getProjectLength"),new M,new A(R.ReaperSetlist,"projectLength")],[e,r,n]=await this.apiClient.executeCommands(t);if(n===void 0)throw new Error("Failed to retrieve projectLength. Please check the script configuration.");return parseFloat(n)}async getOpenTabs(){const t=[new L("getOpenTabs"),new M,new A(R.ReaperSetlist,"tabs"),new A(R.ReaperSetlist,"activeIndex")],[e,r,n,a]=await this.apiClient.executeCommands(t);if(n===void 0)throw new Error("Failed to retrieve tabs. Please check the script configuration.");const i=JSON.parse(n);if(a===void 0)throw new Error("Failed to retrieve activeIndex. Please check the script configuration.");const o=parseFloat(a);return{tabs:i,activeIndex:o}}async writeChunkedData(t,e,r){const n=[new E(R.ReaperSetlist,"section",t),new E(R.ReaperSetlist,"key",e),...this.getChunkCommands("chunks",r),new L("writeChunkedData"),new M];await this.apiClient.executeCommands(n)}async deleteState(t,e){const r=[new E(R.ReaperSetlist,"section",t),new E(R.ReaperSetlist,"key",e),new L("deleteState"),new M];await this.apiClient.executeCommands(r)}}class Ts{constructor(t){this.apiClient=t}async getStateValue(t){const e=new A(R.ReaperSetlist,t);return await this.apiClient.executeCommand(e)}async setStateValue(t,e){const r=new E(R.ReaperSetlist,t,e,!0);await this.apiClient.executeCommand(r)}async getProjectRoot(){return await this.getStateValue(W.ProjectRoot)}async getScriptActionId(){return await this.getStateValue(W.ScriptActionId)}async setProjectRoot(t){await this.setStateValue(W.ProjectRoot,t)}async setScriptActionId(t){await this.setStateValue(W.ScriptActionId,t)}}class bs extends se{async deleteSongFromSets(t){const e=await this.list(),r=[];for(const n of Object.values(e))n.songs.includes(t)&&(n.songs=n.songs.filter(a=>a!==t),r.push(this.update(n.id,n)));await Promise.all(r)}}const xs="/_";class Es{constructor(t=globalThis.fetch,e=xs){I(this,"reaper");I(this,"script");I(this,"scriptSettings");I(this,"songs");I(this,"sets");this.urlRoot=e;const r=new Cs(this.urlRoot,t);this.reaper=r,this.script=new Rs(r),this.scriptSettings=new Ts(r),this.songs=new se(r,this.script,R.Songs),this.sets=new bs(r,this.script,R.Sets)}}function Bt(s){return new Es(s)}var J;class As{constructor(){nt(this,J,Z(qt({scriptActionId:void 0,folderPath:void 0,setupComplete:!1})));I(this,"initialized",!1);I(this,"initializing",!1);I(this,"initPromise",null)}get configuration(){return P(z(this,J))}set configuration(t){K(z(this,J),t,!0)}get data(){return this.configuration}get isSetupComplete(){return this.configuration.setupComplete}get scriptActionId(){return this.configuration.scriptActionId}get folderPath(){return this.configuration.folderPath}async initialize(t){if(!this.initialized){if(this.initializing&&this.initPromise)return this.initPromise;this.initializing=!0,this.initPromise=this._doInitialize(t);try{await this.initPromise}finally{this.initializing=!1,this.initPromise=null}}}async _doInitialize(t){try{const e=Bt(t),[r,n]=await Promise.all([e.scriptSettings.getScriptActionId(),e.scriptSettings.getProjectRoot()]);this.configuration.scriptActionId=r,this.configuration.folderPath=n,this.configuration.setupComplete=!!(n&&r),this.initialized=!0}catch(e){console.error("Error initializing configuration:",e),this.configuration.setupComplete=!1}}ensureInitialized(t){return this.initialized?Promise.resolve():this.initialize(t)}async updateFolderPath(t,e){try{await Bt(e).scriptSettings.setProjectRoot(t),this.configuration.folderPath=t;const n=!!(t&&this.configuration.scriptActionId);this.configuration.setupComplete!==n&&(this.configuration.setupComplete=n)}catch(r){throw console.error("Error updating folder path:",r),r}}updateSetupComplete(){this.configuration.setupComplete=!!(this.configuration.folderPath&&this.configuration.scriptActionId)}reset(){this.configuration.scriptActionId=void 0,this.configuration.folderPath=void 0,this.configuration.setupComplete=!1,this.initialized=!1,this.initializing=!1,this.initPromise=null}}J=new WeakMap;const ft=new As;var Is=He('<svg><path fill="none" stroke="currentColor" stroke-dasharray="16" stroke-dashoffset="16" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3c4.97 0 9 4.03 9 9"><animate fill="freeze" attributeName="stroke-dashoffset" dur="0.2s" values="16;0"></animate><animateTransform attributeName="transform" dur="1.5s" repeatCount="indefinite" type="rotate" values="0 12 12;360 12 12"></animateTransform></path></svg>');function Ps(s,t){const e=Ge(t,["$$slots","$$events","$$legacy"]);var r=Is();rs(r,()=>({viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...e})),V(s,r)}async function ks(s,t,e){var r;s.stopPropagation(),K(t,!0),await((r=e.onclick)==null?void 0:r.call(e)),K(t,!1)}var Os=Jt("<a><!></a>"),Ns=Jt("<button><!></button>");function Gs(s,t){Me(t,!0);let e=qe(t,"variant",3,"text"),r=Z(!1),n=Z(void 0);function a(l,c){if(c==="submit")return"var(--green)";switch(l){default:case"primary":return"var(--primary)";case"delete":return"var(--red)";case"edit":return"var(--yellow)";case"success":return"var(--green)"}}function i(){return e()==="text"}const o=je(()=>a(t.color,t.elementType));var f=Nt(),d=It(f);{var v=l=>{var c=Os();let m;var w=Pt(c);Ft(w,()=>t.children??dt),kt(c),Lt(c,y=>K(n,y),()=>P(n)),Ot(y=>{m=ht(c,1,"button svelte-1xb48l9",null,m,y),O(c,"title",t.title),pt(c,`--button-color: ${P(o)};`),O(c,"href",t.href)},[()=>({"text-button":i()})]),V(l,c)},g=l=>{var c=Ns();let m;c.__click=[ks,r,t];var w=Pt(c);{var y=_=>{Ps(_,{})},S=_=>{var h=Nt(),u=It(h);Ft(u,()=>t.children??dt),V(_,h)};Mt(w,_=>{P(r)?_(y):_(S,!1)})}kt(c),Lt(c,_=>K(n,_),()=>P(n)),Ot(_=>{m=ht(c,1,"button svelte-1xb48l9",null,m,_),O(c,"type",t.elementType==="submit"?"submit":"button"),pt(c,`--button-color: ${P(o)};`),O(c,"title",t.title),O(c,"aria-label",t.title),c.disabled=P(r)||t.disabled},[()=>({"text-button":i()})]),V(l,c)};Mt(d,l=>{t.elementType==="a"?l(v):l(g,!1)})}V(s,f),Le()}Xt(["click"]);export{Gs as B,C,Ps as L,rs as a,zs as b,ht as c,ot as d,Ds as e,Vs as f,Bt as g,Us as h,Ks as i,pt as j,ft as k,O as l,ee as m,Hs as n,Ze as o,Bs as r,Ft as s};
