var ne=Object.defineProperty;var Tt=s=>{throw TypeError(s)};var ie=(s,t,e)=>t in s?ne(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e;var A=(s,t,e)=>ie(s,typeof t!="symbol"?t+"":t,e),ae=(s,t,e)=>t.has(s)||Tt("Cannot "+e);var B=(s,t,e)=>(ae(s,t,"read from private field"),e?e.call(s):t.get(s)),nt=(s,t,e)=>t.has(s)?Tt("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(s):t.set(s,e);import{d as tt,l as I,ap as oe,Q as Ft,e as Y,g as ce,aq as it,am as Vt,y as bt,Z as le,ar as xt,h as b,as as ue,al as fe,at as de,au as mt,av as gt,aw as he,ax as q,b as pe,a8 as Ht,K as me,M as ge,N as At,O as at,P as H,i as K,ai as ve,ab as we,ac as Se,a9 as Ce,ay as Gt,G as _e,az as Et,aA as ye,E as Re,x as dt,A as vt,u as Te,aB as be,aC as xe,X as Ae,aD as Ee,aE as Ie,aF as ke,aG as Pe,aH as Ne,aI as Oe,q as Z,k as qt,o as D,p as Me,f as It,a as Le,c as kt,r as Pt,t as Nt,m as je}from"./Sw90J2G4.js";import{l as Ke,j as De,k as ze,d as Xt,n as Be,o as Ue,p as Fe,q as Ve,b as He,a as V,g as Ot,f as Jt}from"./CS4_VdcA.js";import{r as Ge,p as qe,i as Mt,b as Lt}from"./Czi9triy.js";let ot=null;function Ks(s,t){return t}function Xe(s,t,e,r){for(var n=[],i=t.length,a=0;a<i;a++)ue(t[a].e,n,!0);var o=i>0&&n.length===0&&e!==null;if(o){var f=e.parentNode;fe(f),f.append(e),r.clear(),M(s,t[0].prev,t[i-1].next)}de(n,()=>{for(var h=0;h<i;h++){var g=t[h];o||(r.delete(g.k),M(s,g.prev,g.next)),q(g.e,!o)}})}function Ds(s,t,e,r,n,i=null){var a=s,o={flags:t,items:new Map,first:null},f=(t&Gt)!==0;if(f){var h=s;a=b?at(Se(h)):h.appendChild(Ce())}b&&pe();var g=null,v=!1,l=oe(()=>{var c=e();return Ht(c)?c:c==null?[]:Vt(c)});tt(()=>{var c=I(l),m=c.length;if(v&&m===0)return;v=m===0;let w=!1;if(b){var y=me(a)===ge;y!==(m===0)&&(a=At(),at(a),H(!1),w=!0)}if(b){for(var S=null,_,d=0;d<m;d++){if(K.nodeType===8&&K.data===ve){a=K,w=!0,H(!1);break}var u=c[d],p=r(u,d);_=Yt(K,o,S,null,u,p,d,n,t,e),o.items.set(p,_),S=_}m>0&&at(At())}b||Je(c,o,a,n,t,r,e),i!==null&&(m===0?g?Ft(g):g=Y(()=>i(a)):g!==null&&ce(g,()=>{g=null})),w&&H(!0),I(l)}),b&&(a=K)}function Je(s,t,e,r,n,i,a){var St,Ct,_t,yt;var o=(n&ye)!==0,f=(n&(gt|mt))!==0,h=s.length,g=t.items,v=t.first,l=v,c,m=null,w,y=[],S=[],_,d,u,p;if(o)for(p=0;p<h;p+=1)_=s[p],d=i(_,p),u=g.get(d),u!==void 0&&((St=u.a)==null||St.measure(),(w??(w=new Set)).add(u));for(p=0;p<h;p+=1){if(_=s[p],d=i(_,p),u=g.get(d),u===void 0){var O=l?l.e.nodes_start:e;m=Yt(O,t,m,m===null?t.first:m.next,_,d,p,r,n,a),g.set(d,m),y=[],S=[],l=m.next;continue}if(f&&Ye(u,_,p,n),(u.e.f&it)!==0&&(Ft(u.e),o&&((Ct=u.a)==null||Ct.unfix(),(w??(w=new Set)).delete(u))),u!==l){if(c!==void 0&&c.has(u)){if(y.length<S.length){var R=S[0],k;m=R.prev;var $=y[0],st=y[y.length-1];for(k=0;k<y.length;k+=1)jt(y[k],R,e);for(k=0;k<S.length;k+=1)c.delete(S[k]);M(t,$.prev,st.next),M(t,m,$),M(t,st,R),l=R,m=st,p-=1,y=[],S=[]}else c.delete(u),jt(u,l,e),M(t,u.prev,u.next),M(t,u,m===null?t.first:m.next),M(t,m,u),m=u;continue}for(y=[],S=[];l!==null&&l.k!==d;)(l.e.f&it)===0&&(c??(c=new Set)).add(l),S.push(l),l=l.next;if(l===null)continue;u=l}y.push(u),m=u,l=u.next}if(l!==null||c!==void 0){for(var z=c===void 0?[]:Vt(c);l!==null;)(l.e.f&it)===0&&z.push(l),l=l.next;var rt=z.length;if(rt>0){var re=(n&Gt)!==0&&h===0?e:null;if(o){for(p=0;p<rt;p+=1)(_t=z[p].a)==null||_t.measure();for(p=0;p<rt;p+=1)(yt=z[p].a)==null||yt.fix()}Xe(t,z,re,g)}}o&&_e(()=>{var Rt;if(w!==void 0)for(u of w)(Rt=u.a)==null||Rt.apply()}),bt.first=t.first&&t.first.e,bt.last=m&&m.e}function Ye(s,t,e,r){(r&gt)!==0&&Et(s.v,t),(r&mt)!==0?Et(s.i,e):s.i=e}function Yt(s,t,e,r,n,i,a,o,f,h){var g=ot,v=(f&gt)!==0,l=(f&he)===0,c=v?l?le(n):xt(n):n,m=(f&mt)===0?a:xt(a),w={i:m,v:c,k:i,a:null,e:null,prev:e,next:r};ot=w;try{return w.e=Y(()=>o(s,c,m,h),b),w.e.prev=e&&e.e,w.e.next=r&&r.e,e===null?t.first=w:(e.next=w,e.e.next=w.e),r!==null&&(r.prev=w,r.e.prev=w.e),w}finally{ot=g}}function jt(s,t,e){for(var r=s.next?s.next.e.nodes_start:e,n=t?t.e.nodes_start:e,i=s.e.nodes_start;i!==r;){var a=we(i);n.before(i),i=a}}function M(s,t,e){t===null?s.first=e:(t.next=e,t.e.next=e&&e.e),e!==null&&(e.prev=t,e.e.prev=t&&t.e)}function Kt(s,t,...e){var r=s,n=dt,i;tt(()=>{n!==(n=t())&&(i&&(q(i),i=null),i=Y(()=>n(r,...e)))},Re),b&&(r=K)}function $e(s,t){var e=void 0,r;tt(()=>{e!==(e=t())&&(r&&(q(r),r=null),e&&(r=Y(()=>{vt(()=>e(s))})))})}function $t(s){var t,e,r="";if(typeof s=="string"||typeof s=="number")r+=s;else if(typeof s=="object")if(Array.isArray(s)){var n=s.length;for(t=0;t<n;t++)s[t]&&(e=$t(s[t]))&&(r&&(r+=" "),r+=e)}else for(e in s)s[e]&&(r&&(r+=" "),r+=e);return r}function We(){for(var s,t,e=0,r="",n=arguments.length;e<n;e++)(s=arguments[e])&&(t=$t(s))&&(r&&(r+=" "),r+=t);return r}function Ze(s){return typeof s=="object"?We(s):s??""}const Dt=[...` 	
\r\fÂ \v\uFEFF`];function Qe(s,t,e){var r=s==null?"":""+s;if(t&&(r=r?r+" "+t:t),e){for(var n in e)if(e[n])r=r?r+" "+n:n;else if(r.length)for(var i=n.length,a=0;(a=r.indexOf(n,a))>=0;){var o=a+i;(a===0||Dt.includes(r[a-1]))&&(o===r.length||Dt.includes(r[o]))?r=(a===0?"":r.substring(0,a))+r.substring(o+1):a=o}}return r===""?null:r}function zt(s,t=!1){var e=t?" !important;":";",r="";for(var n in s){var i=s[n];i!=null&&i!==""&&(r+=" "+n+": "+i+e)}return r}function ct(s){return s[0]!=="-"||s[1]!=="-"?s.toLowerCase():s}function ts(s,t){if(t){var e="",r,n;if(Array.isArray(t)?(r=t[0],n=t[1]):r=t,s){s=String(s).replaceAll(/\s*\/\*.*?\*\/\s*/g,"").trim();var i=!1,a=0,o=!1,f=[];r&&f.push(...Object.keys(r).map(ct)),n&&f.push(...Object.keys(n).map(ct));var h=0,g=-1;const w=s.length;for(var v=0;v<w;v++){var l=s[v];if(o?l==="/"&&s[v-1]==="*"&&(o=!1):i?i===l&&(i=!1):l==="/"&&s[v+1]==="*"?o=!0:l==='"'||l==="'"?i=l:l==="("?a++:l===")"&&a--,!o&&i===!1&&a===0){if(l===":"&&g===-1)g=v;else if(l===";"||v===w-1){if(g!==-1){var c=ct(s.substring(h,g).trim());if(!f.includes(c)){l!==";"&&v++;var m=s.substring(h,v).trim();e+=" "+m+";"}}h=v+1,g=-1}}}}return r&&(e+=zt(r)),n&&(e+=zt(n,!0)),e=e.trim(),e===""?null:e}return s==null?null:String(s)}function ht(s,t,e,r,n,i){var a=s.__className;if(b||a!==e||a===void 0){var o=Qe(e,r,i);(!b||o!==s.getAttribute("class"))&&(o==null?s.removeAttribute("class"):t?s.className=o:s.setAttribute("class",o)),s.__className=e}else if(i&&n!==i)for(var f in i){var h=!!i[f];(n==null||h!==!!n[f])&&s.classList.toggle(f,h)}return i}function lt(s,t={},e,r){for(var n in e){var i=e[n];t[n]!==i&&(e[n]==null?s.style.removeProperty(n):s.style.setProperty(n,i,r))}}function pt(s,t,e,r){var n=s.__style;if(b||n!==t){var i=ts(t,r);(!b||i!==s.getAttribute("style"))&&(i==null?s.removeAttribute("style"):s.style.cssText=i),s.__style=t}else r&&(Array.isArray(r)?(lt(s,e==null?void 0:e[0],r[0]),lt(s,e==null?void 0:e[1],r[1],"important")):lt(s,e,r));return r}function Q(s,t,e){if(s.multiple){if(t==null)return;if(!Ht(t))return be();for(var r of s.options)r.selected=t.includes(G(r));return}for(r of s.options){var n=G(r);if(xe(n,t)){r.selected=!0;return}}(!e||t!==void 0)&&(s.selectedIndex=-1)}function Wt(s,t){let e=!0;vt(()=>{t&&Q(s,Te(t),e),e=!1;var r=new MutationObserver(()=>{var n=s.__value;Q(s,n)});return r.observe(s,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),()=>{r.disconnect()}})}function zs(s,t,e=t){var r=!0;Ke(s,"change",n=>{var i=n?"[selected]":":checked",a;if(s.multiple)a=[].map.call(s.querySelectorAll(i),G);else{var o=s.querySelector(i)??s.querySelector("option:not([disabled])");a=o&&G(o)}e(a)}),vt(()=>{var n=t();if(Q(s,n,r),r&&n===void 0){var i=s.querySelector(":checked");i!==null&&(n=G(i),e(n))}s.__value=n,r=!1}),Wt(s)}function G(s){return"__value"in s?s.__value:s.value}const U=Symbol("class"),F=Symbol("style"),Zt=Symbol("is custom element"),Qt=Symbol("is html");function Bs(s){if(b){var t=!1,e=()=>{if(!t){if(t=!0,s.hasAttribute("value")){var r=s.value;P(s,"value",null),s.value=r}if(s.hasAttribute("checked")){var n=s.checked;P(s,"checked",null),s.checked=n}}};s.__on_r=e,Oe(e),Ve()}}function Us(s,t){var e=wt(s);e.value===(e.value=t??void 0)||s.value===t&&(t!==0||s.nodeName!=="PROGRESS")||(s.value=t??"")}function es(s,t){t?s.hasAttribute("selected")||s.setAttribute("selected",""):s.removeAttribute("selected")}function P(s,t,e,r){var n=wt(s);b&&(n[t]=s.getAttribute(t),t==="src"||t==="srcset"||t==="href"&&s.nodeName==="LINK")||n[t]!==(n[t]=e)&&(t==="loading"&&(s[Pe]=e),e==null?s.removeAttribute(t):typeof e!="string"&&te(s).includes(t)?s[t]=e:s.setAttribute(t,e))}function ss(s,t,e,r,n=!1){var i=wt(s),a=i[Zt],o=!i[Qt];let f=b&&a;f&&H(!1);var h=t||{},g=s.tagName==="OPTION";for(var v in t)v in e||(e[v]=null);e.class?e.class=Ze(e.class):e[U]&&(e.class=null),e[F]&&(e.style??(e.style=null));var l=te(s);for(const d in e){let u=e[d];if(g&&d==="value"&&u==null){s.value=s.__value="",h[d]=u;continue}if(d==="class"){var c=s.namespaceURI==="http://www.w3.org/1999/xhtml";ht(s,c,u,r,t==null?void 0:t[U],e[U]),h[d]=u,h[U]=e[U];continue}if(d==="style"){pt(s,u,t==null?void 0:t[F],e[F]),h[d]=u,h[F]=e[F];continue}var m=h[d];if(u!==m){h[d]=u;var w=d[0]+d[1];if(w!=="$$")if(w==="on"){const p={},O="$$"+d;let R=d.slice(2);var y=Fe(R);if(De(R)&&(R=R.slice(0,-7),p.capture=!0),!y&&m){if(u!=null)continue;s.removeEventListener(R,h[O],p),h[O]=null}if(u!=null)if(y)s[`__${R}`]=u,Xt([R]);else{let k=function($){h[d].call(this,$)};h[O]=ze(R,s,k,p)}else y&&(s[`__${R}`]=void 0)}else if(d==="style")P(s,d,u);else if(d==="autofocus")Be(s,!!u);else if(!a&&(d==="__value"||d==="value"&&u!=null))s.value=s.__value=u;else if(d==="selected"&&g)es(s,u);else{var S=d;o||(S=Ue(S));var _=S==="defaultValue"||S==="defaultChecked";if(u==null&&!a&&!_)if(i[d]=null,S==="value"||S==="checked"){let p=s;const O=t===void 0;if(S==="value"){let R=p.defaultValue;p.removeAttribute(S),p.defaultValue=R,p.value=p.__value=O?R:null}else{let R=p.defaultChecked;p.removeAttribute(S),p.defaultChecked=R,p.checked=O?R:!1}}else s.removeAttribute(d);else _||l.includes(S)&&(a||typeof u!="string")?s[S]=u:typeof u!="function"&&P(s,S,u)}}}return f&&H(!0),h}function rs(s,t,e=[],r,n=!1,i=Ae){const a=e.map(i);var o=void 0,f={},h=s.nodeName==="SELECT",g=!1;tt(()=>{var v=t(...a.map(I));ss(s,o,v,r,n),g&&h&&"value"in v&&Q(s,v.value,!1);for(let c of Object.getOwnPropertySymbols(f))v[c]||q(f[c]);for(let c of Object.getOwnPropertySymbols(v)){var l=v[c];c.description===Ee&&(!o||l!==o[c])&&(f[c]&&q(f[c]),f[c]=Y(()=>$e(s,()=>l)))}o=v}),h&&Wt(s,()=>o.value),g=!0}function wt(s){return s.__attributes??(s.__attributes={[Zt]:s.nodeName.includes("-"),[Qt]:s.namespaceURI===Ie})}var Bt=new Map;function te(s){var t=Bt.get(s.nodeName);if(t)return t;Bt.set(s.nodeName,t=[]);for(var e,r=s,n=Element.prototype;n!==r;){e=Ne(r);for(var i in e)e[i].set&&t.push(i);r=ke(r)}return t}function Fs(s){const t=Math.floor(s/60),e=Math.floor(s%60);return`${t}:${e.toString().padStart(2,"0")}`}function ee(){return typeof crypto<"u"&&crypto.randomUUID?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(s){const t=Math.random()*16|0;return(s==="x"?t:t&3|8).toString(16)})}var X;class ns{constructor(){nt(this,X,Z(qt([])))}get notifications(){return I(B(this,X))}set notifications(t){D(B(this,X),t,!0)}get items(){return this.notifications}add(t,e="primary",r){const n=ee(),i={id:n,message:t,type:e,duration:r,timestamp:new Date};return this.notifications=[...this.notifications,i],r!==void 0&&setTimeout(()=>{this.remove(n)},r),n}remove(t){this.notifications=this.notifications.filter(e=>e.id!==t)}clear(){this.notifications=[]}success(t,e=5e3){return this.add(t,"success",e)}error(t,e){return this.add(t,"delete",e)}warning(t,e=7e3){return this.add(t,"edit",e)}info(t,e=5e3){return this.add(t,"primary",e)}}X=new WeakMap;const Vs=new ns,is="Operation",W={ProjectRoot:"ProjectRoot",ScriptActionId:"ScriptActionId"},T={ReaperSetlist:"ReaperSetlist",Songs:"ReaperSetlist.Songs",Sets:"ReaperSetlist.Sets"};class et{}class as extends et{parseResponse(t){if(!t)throw new Error("Empty transport response");const e=t.split("	");if(e.length!==6)throw new Error(`Unexpected transport format: ${t}`);return{playState:parseInt(e[1],10),positionSeconds:parseFloat(e[2]),repeatOn:e[3]==="1",positionString:e[4],positionStringBeats:e[5]}}getResponseMarker(){return"TRANSPORT"}async getCommandString(){return Promise.resolve("TRANSPORT")}}class os extends et{parseResponse(t){const e=[];for(const r of t){if(r.startsWith("MARKER_LIST"))continue;if(r.startsWith("MARKER_LIST_END"))break;const n=r.split("	");if(n.length<4)throw new Error(`Invalid marker line: ${r}`);const i={id:parseInt(n[2],10),name:n[1],position:parseFloat(n[3])};e.push(i)}return e}getResponseMarker(){return"MARKER_LIST"}async getCommandString(){return Promise.resolve("MARKER")}}class x extends et{parseResponse(t){}getResponseMarker(){}}class cs extends x{getCommandString(){return Promise.resolve("40042")}}class ls extends x{getCommandString(){return Promise.resolve("40859")}}class us extends x{getCommandString(){return Promise.resolve("40860")}}class fs extends x{getCommandString(){return Promise.resolve("40861")}}class ds extends x{getCommandString(){return Promise.resolve("40862")}}class hs extends x{getCommandString(){return Promise.resolve("1007")}}class ps extends x{getCommandString(){return Promise.resolve("1008")}}class ms extends x{getCommandString(){return Promise.resolve("1016")}}class gs extends x{getCommandString(){return Promise.resolve("1013")}}class L extends x{async getCommandString(){if(await ft.ensureInitialized(),!ft.scriptActionId)throw new Error("Script action ID is not set. Please configure it in the settings.");return ft.scriptActionId}}class vs extends x{constructor(t){super(),this.markerId=t}async getCommandString(){return Promise.resolve(`SET/POS_STR/m${this.markerId}`)}}class E extends x{constructor(t,e,r,n=!1){super(),this.section=t,this.key=e,this.value=r,this.persist=n}async getCommandString(){const t=this.persist?"SET/EXTSTATEPERSIST":"SET/EXTSTATE",e=encodeURIComponent(this.value);return Promise.resolve(`${t}/${this.section}/${this.key}/${e}`)}}class j extends E{constructor(t){super(T.ReaperSetlist,is,t,!1)}}class N extends et{constructor(t,e,r=!0){super(),this.section=t,this.key=e,this.temp=r}getCommandString(){const t=this.temp?"GET/EXTSTATE":"GET/EXTSTATE_PERSIST";return Promise.resolve(`${t}/${this.section}/${this.key}`)}parseResponse(t){if(!t||t.trim()==="")return;const e=t.trim(),r=e.split("	");if(r.length===4&&r[0]==="EXTSTATE"&&r[1]===this.section&&r[2]===this.key)return r[3];if(r.length===3&&r[0]==="EXTSTATE"&&r[1]===this.section&&r[2]===this.key)return;throw new Error(`Unexpected response format: ${e}`)}getResponseMarker(){return"EXTSTATE"}}const C={transport:()=>new as,markers:()=>new os,goToStart:()=>new cs,goToMarker:s=>new vs(s),newTab:()=>new ls,closeAllTabs:()=>new us,nextTab:()=>new fs,previousTab:()=>new ds,play:()=>new hs,pause:()=>new ps,stop:()=>new ms,record:()=>new gs},ws=600;class Ss{constructor(t,e=globalThis.fetch){A(this,"urlRoot");A(this,"fetch");this.urlRoot=t,this.fetch=e}async executeCommand(t){const[e]=await this.executeCommands([t]);return e}async executeCommands(t){const e=await Promise.all(t.map(i=>i.getCommandString())),r=await this.sendRawCommands(e);return this.parseMultiCommandResponse(t,r)}parseMultiCommandResponse(t,e){const r=[];let n=0;for(const i of t){if(!i.getResponseMarker()){r.push(void 0);continue}const a=e[n];if(a.length===0)throw new Error(`Empty response for command: ${i.getCommandString()}`);const o=a.split("	")[0];if(o!==i.getResponseMarker())throw new Error(`Unexpected response type for command ${i.getCommandString()}: expected ${i.getResponseMarker()}, got ${o}`);if(i.getResponseMarker()==="MARKER_LIST"){const f=i.parseResponse(e.slice(n)),h=f;r.push(f),n+=h.length+1}else{const f=i.parseResponse(a);r.push(f)}n++}return r}async sendCommand(t){return this.sendRawCommand(t)}async sendCommands(t){return this.sendRawCommands(t)}async getTransport(){return this.executeCommand(C.transport())}async goToStart(){const[t,e]=await this.executeCommands([C.goToStart(),C.transport()]);return e}async play(){const[,t]=await this.executeCommands([C.play(),C.transport()]);return t}async pause(){const[,t]=await this.executeCommands([C.pause(),C.transport()]);return t}async stop(){const[,t]=await this.executeCommands([C.stop(),C.transport()]);return t}async record(){const[,t]=await this.executeCommands([C.record(),C.transport()]);return t}async newTab(){await this.executeCommand(C.newTab())}async closeAllTabs(){await this.executeCommand(C.closeAllTabs())}async nextTab(){const[,t,e]=await this.executeCommands([C.nextTab(),C.transport(),C.markers()]);return{markers:e,transport:t}}async previousTab(){const[,t,e]=await this.executeCommands([C.previousTab(),C.transport(),C.markers()]);return{markers:e,transport:t}}async getMarkers(){return this.executeCommand(C.markers())}async goToMarker(t){const[e,r]=await this.executeCommands([C.goToMarker(t),C.transport()]);return r}async playAndGetFullState(){const[t,e,r]=await this.executeCommands([C.play(),C.transport(),C.markers()]);return{playResult:t,transport:e,markers:r}}async sendRawCommand(t){const e=await this.fetch(`${this.urlRoot}/${t}`,{method:"GET"});if(!e.ok)throw new Error(`Failed to send command ${t}: ${e.statusText}`);return(await e.text()).split(`
`).filter(i=>i.trim()!=="")}async sendRawCommands(t){if(t.length===0)return[];const e=[],r=this.batchCommandsByUrlLength(t);for(const n of r){const i=`${this.urlRoot}/${n.join(";")}`,a=await this.fetch(i,{method:"GET"});if(!a.ok)throw new Error(`Failed to send commands ${n.join(",")}: ${a.statusText}`);const f=(await a.text()).split(`
`).slice(0,-1);e.push(...f)}return e}batchCommandsByUrlLength(t){const e=[];let r=[],n=this.urlRoot.length;for(const i of t){const o=(r.length>0?";":"").length+i.length;n+o>ws&&r.length>0?(e.push([...r]),r=[i],n=this.urlRoot.length+i.length):(r.push(i),n+=o)}return r.length>0&&e.push(r),e}}class Cs{}const _s=500,ut="__index__";class se extends Cs{constructor(t,e,r){super(),this.apiClient=t,this.scriptClient=e,this.sectionKey=r}async fetchIndex(){const t=new N(this.sectionKey,ut),e=await this.apiClient.executeCommand(t);return e?JSON.parse(e):[]}async saveData(t,e){JSON.stringify(e).length<=_s?await this.apiClient.executeCommand(new E(this.sectionKey,t,JSON.stringify(e))):await this.scriptClient.writeChunkedData(this.sectionKey,t,e)}async saveIndex(t){await this.saveData(ut,t)}async fetchById(t){const e=new N(this.sectionKey,t),r=await this.apiClient.executeCommand(e);return r?JSON.parse(r):void 0}async saveById(t,e){await this.saveData(t,e)}async deleteById(t){await this.scriptClient.deleteState(this.sectionKey,t)}async get(t){return this.fetchById(t)}async update(t,e){await this.saveById(t,e)}async add(t){const e=ee(),r={...t,id:e};await this.saveById(e,r);const n=await this.fetchIndex();return n.push(e),await this.saveIndex(n),r}async delete(t){await this.deleteById(t);const r=(await this.fetchIndex()).filter(n=>n!==t);await this.saveIndex(r)}async list(){const t=new N(this.sectionKey,ut),e=await this.apiClient.executeCommand(t);if(!e)return{};const r=JSON.parse(e),n={},i=r.map(o=>new N(this.sectionKey,o)),a=await this.apiClient.executeCommands(i);for(const o of a)if(o){const f=JSON.parse(o);n[f.id]=f}return n}}class ys{constructor(t){this.apiClient=t}getChunkCommands(t,e){const r=[],n=JSON.stringify(e),i=500;for(let o=0;o<n.length;o+=i)r.push(n.slice(o,o+i));const a=[];a.push(new E(T.ReaperSetlist,`${t}_length`,r.length.toString()));for(let o=0;o<r.length;o++)a.push(new E(T.ReaperSetlist,`${t}_${o}`,r[o]));return a}async listProjects(){const t=[new j("listProjects"),new L,new N(T.ReaperSetlist,"projects")],[e,r,n]=await this.apiClient.executeCommands(t);if(n===void 0)throw new Error("Failed to retrieve projects. Please check the script configuration.");return JSON.parse(n)}async openProject(t){const e=[new E(T.ReaperSetlist,"projectPath",t),new j("openProject"),new L];await this.apiClient.executeCommands(e)}async testActionId(t){const e=[new E(T.ReaperSetlist,"testNonce",t),new j("testActionId"),new L,new N(T.ReaperSetlist,"testOutput")],[r,n,i,a]=await this.apiClient.executeCommands(e);if(a===void 0)throw new Error("Failed to retrieve testOutput. Please check the script configuration.");return a}async getProjectLength(){const t=[new j("getProjectLength"),new L,new N(T.ReaperSetlist,"projectLength")],[e,r,n]=await this.apiClient.executeCommands(t);if(n===void 0)throw new Error("Failed to retrieve projectLength. Please check the script configuration.");return parseFloat(n)}async getOpenTabs(){const t=[new j("getOpenTabs"),new L,new N(T.ReaperSetlist,"tabs")],[e,r,n]=await this.apiClient.executeCommands(t);if(n===void 0)throw new Error("Failed to retrieve tabs. Please check the script configuration.");return JSON.parse(n)}async writeChunkedData(t,e,r){const n=[new E(T.ReaperSetlist,"section",t),new E(T.ReaperSetlist,"key",e),...this.getChunkCommands("chunks",r),new j("writeChunkedData"),new L];await this.apiClient.executeCommands(n)}async deleteState(t,e){const r=[new E(T.ReaperSetlist,"section",t),new E(T.ReaperSetlist,"key",e),new j("deleteState"),new L];await this.apiClient.executeCommands(r)}}class Rs{constructor(t){this.apiClient=t}async getStateValue(t){const e=new N(T.ReaperSetlist,t);return await this.apiClient.executeCommand(e)}async setStateValue(t,e){const r=new E(T.ReaperSetlist,t,e,!0);await this.apiClient.executeCommand(r)}async getProjectRoot(){return await this.getStateValue(W.ProjectRoot)}async getScriptActionId(){return await this.getStateValue(W.ScriptActionId)}async setProjectRoot(t){await this.setStateValue(W.ProjectRoot,t)}async setScriptActionId(t){await this.setStateValue(W.ScriptActionId,t)}}class Ts extends se{async deleteSongFromSets(t){const e=await this.list(),r=[];for(const n of Object.values(e))n.songs.includes(t)&&(n.songs=n.songs.filter(i=>i!==t),r.push(this.update(n.id,n)));await Promise.all(r)}}const bs="/_";class xs{constructor(t=globalThis.fetch,e=bs){A(this,"reaper");A(this,"script");A(this,"scriptSettings");A(this,"songs");A(this,"sets");this.urlRoot=e;const r=new Ss(this.urlRoot,t);this.reaper=r,this.script=new ys(r),this.scriptSettings=new Rs(r),this.songs=new se(r,this.script,T.Songs),this.sets=new Ts(r,this.script,T.Sets)}}function Ut(s){return new xs(s)}var J;class As{constructor(){nt(this,J,Z(qt({scriptActionId:void 0,folderPath:void 0,setupComplete:!1})));A(this,"initialized",!1);A(this,"initializing",!1);A(this,"initPromise",null)}get configuration(){return I(B(this,J))}set configuration(t){D(B(this,J),t,!0)}get data(){return this.configuration}get isSetupComplete(){return this.configuration.setupComplete}get scriptActionId(){return this.configuration.scriptActionId}get folderPath(){return this.configuration.folderPath}async initialize(t){if(!this.initialized){if(this.initializing&&this.initPromise)return this.initPromise;this.initializing=!0,this.initPromise=this._doInitialize(t);try{await this.initPromise}finally{this.initializing=!1,this.initPromise=null}}}async _doInitialize(t){try{const e=Ut(t),[r,n]=await Promise.all([e.scriptSettings.getScriptActionId(),e.scriptSettings.getProjectRoot()]);this.configuration.scriptActionId=r,this.configuration.folderPath=n,this.configuration.setupComplete=!!(n&&r),this.initialized=!0}catch(e){console.error("Error initializing configuration:",e),this.configuration.setupComplete=!1}}ensureInitialized(t){return this.initialized?Promise.resolve():this.initialize(t)}async updateFolderPath(t,e){try{await Ut(e).scriptSettings.setProjectRoot(t),this.configuration.folderPath=t;const n=!!(t&&this.configuration.scriptActionId);this.configuration.setupComplete!==n&&(this.configuration.setupComplete=n)}catch(r){throw console.error("Error updating folder path:",r),r}}updateSetupComplete(){this.configuration.setupComplete=!!(this.configuration.folderPath&&this.configuration.scriptActionId)}reset(){this.configuration.scriptActionId=void 0,this.configuration.folderPath=void 0,this.configuration.setupComplete=!1,this.initialized=!1,this.initializing=!1,this.initPromise=null}}J=new WeakMap;const ft=new As;var Es=He('<svg><path fill="none" stroke="currentColor" stroke-dasharray="16" stroke-dashoffset="16" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3c4.97 0 9 4.03 9 9"><animate fill="freeze" attributeName="stroke-dashoffset" dur="0.2s" values="16;0"></animate><animateTransform attributeName="transform" dur="1.5s" repeatCount="indefinite" type="rotate" values="0 12 12;360 12 12"></animateTransform></path></svg>');function Is(s,t){const e=Ge(t,["$$slots","$$events","$$legacy"]);var r=Es();rs(r,()=>({viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...e})),V(s,r)}async function ks(s,t,e){var r;s.stopPropagation(),D(t,!0),await((r=e.onclick)==null?void 0:r.call(e)),D(t,!1)}var Ps=Jt("<a><!></a>"),Ns=Jt("<button><!></button>");function Hs(s,t){Me(t,!0);let e=qe(t,"variant",3,"text"),r=Z(!1),n=Z(void 0);function i(l,c){if(c==="submit")return"var(--green)";switch(l){default:case"primary":return"var(--primary)";case"delete":return"var(--red)";case"edit":return"var(--yellow)";case"success":return"var(--green)"}}function a(){return e()==="text"}const o=je(()=>i(t.color,t.elementType));var f=Ot(),h=It(f);{var g=l=>{var c=Ps();let m;var w=kt(c);Kt(w,()=>t.children??dt),Pt(c),Lt(c,y=>D(n,y),()=>I(n)),Nt(y=>{m=ht(c,1,"button svelte-1xb48l9",null,m,y),P(c,"title",t.title),pt(c,`--button-color: ${I(o)};`),P(c,"href",t.href)},[()=>({"text-button":a()})]),V(l,c)},v=l=>{var c=Ns();let m;c.__click=[ks,r,t];var w=kt(c);{var y=_=>{Is(_,{})},S=_=>{var d=Ot(),u=It(d);Kt(u,()=>t.children??dt),V(_,d)};Mt(w,_=>{I(r)?_(y):_(S,!1)})}Pt(c),Lt(c,_=>D(n,_),()=>I(n)),Nt(_=>{m=ht(c,1,"button svelte-1xb48l9",null,m,_),P(c,"type",t.elementType==="submit"?"submit":"button"),pt(c,`--button-color: ${I(o)};`),P(c,"title",t.title),P(c,"aria-label",t.title),c.disabled=I(r)||t.disabled},[()=>({"text-button":a()})]),V(l,c)};Mt(h,l=>{t.elementType==="a"?l(g):l(v,!1)})}V(s,f),Le()}Xt(["click"]);export{Hs as B,Is as L,rs as a,zs as b,ht as c,ot as d,Ds as e,Fs as f,Ut as g,Us as h,Ks as i,ft as j,P as k,ee as l,pt as m,Vs as n,Bs as r,Kt as s};
